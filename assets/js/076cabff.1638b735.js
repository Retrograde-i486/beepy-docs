"use strict";(self.webpackChunkbeepy=self.webpackChunkbeepy||[]).push([[636],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>b});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var p=n.createContext({}),s=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},c=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=s(r),m=a,b=d["".concat(p,".").concat(m)]||d[m]||u[m]||o;return r?n.createElement(b,l(l({ref:t},c),{},{components:r})):n.createElement(b,l({ref:t},c))}));function b(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,l=new Array(o);l[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[d]="string"==typeof e?e:a,l[1]=i;for(var s=2;s<o;s++)l[s]=r[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},2381:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var n=r(7462),a=(r(7294),r(3905));const o={sidebar_position:2},l="Power Management & Battery",i={unversionedId:"firmware/power",id:"firmware/power",title:"Power Management & Battery",description:'The onboard RP2040 controls the power to the Pi, as well as measuring the battery level with its ADC. The Beepy can be safely shutdown by holding the "End Call" button on the keyboard.',source:"@site/docs/firmware/power.md",sourceDirName:"firmware",slug:"/firmware/power",permalink:"/docs/firmware/power",draft:!1,editUrl:"https://github.com/sqfmi/beepy-docs/blob/main/docs/firmware/power.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Keyboard Firmware",permalink:"/docs/firmware/keyboard"},next:{title:"RGB LED",permalink:"/docs/firmware/rgb-led"}},p={},s=[{value:"Examples",id:"examples",level:2},{value:"Battery Level Reporting",id:"battery-level-reporting",level:3},{value:"Command-line Example",id:"command-line-example",level:4},{value:"Script",id:"script",level:2},{value:"Sleep/Wake",id:"sleepwake",level:3}],c={toc:s},d="wrapper";function u(e){let{components:t,...r}=e;return(0,a.kt)(d,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"power-management--battery"},"Power Management & Battery"),(0,a.kt)("p",null,'The onboard RP2040 controls the power to the Pi, as well as measuring the battery level with its ADC. The Beepy can be safely shutdown by holding the "End Call" button on the keyboard.'),(0,a.kt)("h2",{id:"examples"},"Examples"),(0,a.kt)("h3",{id:"battery-level-reporting"},"Battery Level Reporting"),(0,a.kt)("p",null,"To read the battery voltage on the Beepy, you can read from the register ",(0,a.kt)("inlineCode",{parentName:"p"},"0x17")," over I2C."),(0,a.kt)("p",null,"This is a read-only register, it is 2 bytes in size."),(0,a.kt)("p",null,"It returns a 16 bit value from the ADC (VREF = 3.3V). On the Beepy there is a voltage divider, so the battery voltage can be calculated as ",(0,a.kt)("strong",{parentName:"p"},"VBAT = 3.3V ","*"," (value/4095) ","*"," 2"),"."),(0,a.kt)("h4",{id:"command-line-example"},"Command-line Example"),(0,a.kt)("p",null,"First release the I2C bus from the keyboard driver, then read 1 word (2 bytes) from I2C bus 1, address 0x1F, register 0x17"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo modprobe -r bbqX0kbd\nsudo i2cget -y 1 0x1F 0x17 w\n")),(0,a.kt)("h2",{id:"script"},"Script"),(0,a.kt)("p",null,"Script to calculate the battery voltage"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"#!/bin/sh\n\nsudo modprobe -r bbqX0kbd\nV=$(i2cget -y 1 0x1F 0x17 w | sed s/0x// | tr '[:lower:]' '[:upper:]')\nsudo modprobe bbqX0kbd\n\nV=$(echo \"obase=10; ibase=16; $V\" | bc)\necho \"$V * 3.3 * 2 / 4095\" | bc -l | cut -c1-5\n")),(0,a.kt)("h3",{id:"sleepwake"},"Sleep/Wake"),(0,a.kt)("p",null,"To Do"))}u.isMDXComponent=!0}}]);